<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PolyVis Docs v3 (Fork)</title>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js"></script>

    <link rel="stylesheet" href="/css/app.css" />
    <link rel="stylesheet" href="/css/markdown.css" />
    <!-- Inline Theme Init to prevent FOUC -->
    <script>
        (function () {
            const stored = localStorage.getItem('polyvis-theme');
            if (stored) {
                document.documentElement.setAttribute('data-theme', stored);
            }
        })();
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Alpine.js -->
    <script src="/js/app.js" defer></script>
    <!-- Theme Logic -->
    <script type="module" src="/js/utils/theme.js"></script>
</head>

<body class="page-layout overflow-hidden h-screen" x-data="docViewer()"
    :class="{ 'loaded': true, 'layout-debug-mode': false }"
    @keydown.window.shift.d="document.body.classList.toggle('debug-mode')">

    <div class="app-shell"
        :style="{ 'grid-template-columns': viewMode === 'reference' ? '0px minmax(0, 1fr) 350px' : '250px minmax(0, 1fr) 0px' }">
        <header class="app-header relative">
            <!-- Mobile Toggle Left -->
            <button class="md:hidden absolute left-4 p-2" @click="leftOpen = !leftOpen; rightOpen = false">
                <i data-lucide="menu" class="w-6 h-6 text-[var(--primary)]"></i>
            </button>

            <div x-data="navigation" x-html="view" class="w-full"></div>

            <!-- Mobile Toggle Right -->
            <button class="md:hidden absolute right-4 p-2" @click="rightOpen = !rightOpen; leftOpen = false">
                <i data-lucide="info" class="w-6 h-6 text-[var(--primary)]"></i>
            </button>
        </header>

        <!-- Mobile Backdrop -->
        <div x-show="leftOpen || rightOpen" @click="leftOpen = false; rightOpen = false" x-transition.opacity
            class="fixed inset-0 bg-black/50 z-40 md:hidden backdrop-blur-sm">
        </div>

        <!-- LEFT SIDEBAR: DIRECTORY & TOC -->
        <aside class="app-sidebar-left overflow-hidden md:block p-0 md:translate-x-0 relative"
            :class="{ 'translate-x-0': leftOpen, '-translate-x-full': !leftOpen, 'block': true, 'hidden': false }"
            x-show="viewMode === 'browse' || leftOpen">
            <div class="container-box docs-directory h-full flex flex-col"
                style="overflow: hidden; height: 100%; padding: 0; border: none; background-color: var(--surface-1);">

                <!-- TABS -->
                <div class="flex border-b sticky top-0 z-10"
                    style="border-color: var(--border-base); background-color: var(--surface-2);">
                    <button @click="navTab = 'index'"
                        class="flex-1 py-3 text-xs font-bold uppercase tracking-wider text-center border-b-2 transition-colors"
                        :style="{
                        borderColor: navTab === 'index' ? 'var(--color-brand)' : 'transparent',
                        color: navTab === 'index' ? 'var(--color-brand)' : 'var(--text-2)',
                        backgroundColor: navTab === 'index' ? 'var(--surface-1)' : 'transparent'
                    }">
                        Index
                    </button>
                    <button @click="navTab = 'outline'"
                        class="flex-1 py-3 text-xs font-bold uppercase tracking-wider text-center border-b-2 transition-colors"
                        :style="{
                        borderColor: navTab === 'outline' ? 'var(--color-brand)' : 'transparent',
                        color: navTab === 'outline' ? 'var(--color-brand)' : 'var(--text-2)',
                        backgroundColor: navTab === 'outline' ? 'var(--surface-1)' : 'transparent'
                    }">
                        Outline
                    </button>
                    <button class="md:hidden px-3 border-l" style="border-color: var(--border-base);"
                        @click="leftOpen = false">
                        <i data-lucide="x" class="w-4 h-4" style="color: var(--text-2);"></i>
                    </button>
                </div>

                <!-- TAB CONTENT: INDEX -->
                <nav x-show="navTab === 'index'"
                    class="file-list-container flex flex-col gap-1 p-4 overflow-y-auto flex-1 min-h-0">
                    <template x-for="doc in docs" :key="doc.file">
                        <a href="#" @click.prevent="loadMain(doc.file)"
                            class="doc-link block px-4 py-2 text-sm rounded transition-colors" :style="{
                       backgroundColor: activeDoc === doc.file ? 'var(--surface-2)' : 'transparent',
                       color: activeDoc === doc.file ? 'var(--color-brand)' : 'var(--text-1)',
                       fontWeight: activeDoc === doc.file ? 'bold' : 'normal'
                   }" class="hover:bg-[var(--surface-hover)]">
                            <span x-text="doc.title || doc.file"></span>
                        </a>
                    </template>
                </nav>

                <!-- TAB CONTENT: OUTLINE (ToC) -->
                <nav x-show="navTab === 'outline'"
                    class="file-list-container flex flex-col gap-1 p-4 overflow-y-auto flex-1 min-h-0">
                    <!-- Current Doc Title -->
                    <div class="mb-4 pb-2 border-b" style="border-color: var(--border-base);">
                        <h4 class="text-xs font-bold uppercase tracking-wider mb-1" style="color: var(--text-2);">
                            Current Document</h4>
                        <div class="text-sm font-bold" style="color: var(--text-1);"
                            x-text="docs.find(d => d.file === activeDoc)?.title || activeDoc"></div>
                    </div>

                    <template x-for="item in toc" :key="item.id">
                        <a :href="'#' + item.id" class="block py-1 pr-2 text-sm hover:underline" :style="{
                       paddingLeft: ((item.level - 2) * 0.75 + 0.5) + 'rem',
                       color: 'var(--text-1)',
                       opacity: item.level === 2 ? '1' : '0.8'
                   }" x-text="item.text">
                        </a>
                    </template>
                    <div x-show="toc.length === 0" class="p-4 text-sm italic text-center" style="color: var(--text-2);">
                        No headers found in this document.
                    </div>
                </nav>

            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="app-main overflow-y-auto custom-scrollbar px-2 md:px-6 items-start place-items-start block"
            @click="handleContentClick($event)">
            <div class="prose max-w-[65ch] mx-auto py-8" id="main-content" x-html="contentMain">
                <!-- Content injected here -->
                <div class="flex h-full flex-col items-center justify-center pt-20">
                    <p class="animate-pulse font-mono text-gray-400">Loading Content...</p>
                </div>
            </div>
        </main>

        <!-- RIGHT SIDEBAR: REFERENCE PANEL -->
        <aside class="app-sidebar-right overflow-hidden md:block p-0 md:translate-x-0 relative"
            :class="{ 'translate-x-0': rightOpen, 'translate-x-full': !rightOpen, 'block': true, 'hidden': false }"
            x-show="viewMode === 'reference' || rightOpen" style="border-left: 1px solid var(--border-base);">

            <div class="container-box docs-directory-right h-full flex flex-col"
                style="overflow: hidden; height: 100%; padding: 0; border: none; background-color: var(--surface-1);">

                <!-- HEADER -->
                <div class="flex items-center justify-between p-3 border-b sticky top-0 z-10"
                    style="border-color: var(--border-base); background-color: var(--surface-2);">
                    <h3 class="text-xs font-bold uppercase tracking-wider" style="color: var(--text-2);">Reference</h3>
                    <button @click="goBack()"
                        class="flex items-center gap-1 text-xs font-bold px-2 py-1 rounded hover:bg-gray-200 transition-colors"
                        style="color: var(--color-brand);">
                        <i data-lucide="arrow-left" class="w-3 h-3"></i> Back
                    </button>
                </div>

                <!-- CONTENT -->
                <div class="p-4 overflow-y-auto flex-1 min-h-0 prose prose-sm max-w-none" x-html="contentRef">
                    <!-- Reference Content Injected Here -->
                </div>
            </div>
        </aside>
        <footer class="app-footer text-center font-mono text-xs text-gray-400">
            &copy; 2025 PolyVis | Structural Information Engineering
        </footer>
    </div>


</body>

</html>