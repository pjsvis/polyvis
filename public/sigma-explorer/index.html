<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PolyVis | Layout Test</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="//unpkg.com/alpinejs" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    <script src="https://unpkg.com/graphology@0.25.4/dist/graphology.umd.js"></script>
    <script src="https://unpkg.com/sigma@2.4.0/build/sigma.min.js"></script>
    <script src="https://unpkg.com/graphology-library@0.8.0/dist/graphology-library.min.js"></script>
    <link rel="stylesheet" href="/css/style.css" />
    <style>
        /* Custom Scrollbar for Sidebars */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: #94a3b8;
        }
    </style>
</head>

<!-- 
  STRICT FLEX LAYOUT SKELETON
  1. Body: Viewport Container
  2. Outer Flex: Navbar + Main
  3. Main Flex: Left + Graph + Right
-->

<body class="h-screen w-screen overflow-hidden text-sm antialiased" style="background-color: var(--accent);"
    x-data="sigmaApp()" :class="{ 'loaded': loaded }">

    <script src="/components/nav.js"></script>

    <!-- Outer Flex Container (Vertical) -->
    <div class="flex h-full w-full flex-col">

        <!-- 1. Navbar (Fixed Height) -->
        <div class="flex-none">
            <div x-data="navigation" x-html="view"></div>
        </div>

        <!-- 2. Main Content (Fills remaining height) -->
        <div class="flex flex-row flex-nowrap flex-grow overflow-hidden relative">

            <!-- 2a. Left Sidebar (Fixed Width, Collapsible) -->
            <div x-show="leftOpen"
                class="flex-none w-48 flex flex-col border-r border-gray-300 bg-white shadow-sm transition-all z-20"
                x-transition:enter="transition ease-out duration-200" x-transition:enter-start="-translate-x-full"
                x-transition:enter-end="translate-x-0" x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="translate-x-0" x-transition:leave-end="-translate-x-full">
                <div class="flex items-center justify-between p-2 border-b border-gray-200 bg-gray-50">
                    <span class="font-mono text-xs font-bold uppercase text-gray-600">Controls</span>
                    <button @click="leftOpen = false" class="text-gray-500 hover:text-black">
                        <i data-lucide="chevron-left" class="w-4 h-4"></i>
                    </button>
                </div>

                <!-- Sidebar Content -->
                <div class="flex-grow overflow-visible p-4 space-y-4">
                    <!-- Analysis Group -->
                    <div>
                        <div class="mb-2 font-mono text-[10px] font-bold uppercase text-gray-400">Analysis</div>
                        <div class="space-y-2">
                            <!-- Louvain -->
                            <div class="group relative">
                                <button class="btn-structural w-full justify-start gap-1 text-xs"
                                    :class="{ 'active': activeColorViz === 'louvain' }"
                                    @click="toggleColorViz('louvain')">
                                    <i data-lucide="users" class="h-3 w-3"></i> Louvain
                                </button>
                                <div
                                    class="hidden group-hover:block absolute left-full top-0 ml-2 w-48 p-2 bg-black text-white text-xs font-bold rounded shadow-lg z-50 pointer-events-none">
                                    Detects communities (clusters) and colors nodes to show group membership.
                                </div>
                            </div>

                            <!-- PageRank -->
                            <div class="group relative">
                                <button class="btn-structural w-full justify-start gap-1 text-xs"
                                    :class="{ 'active': activeSizeViz === 'pagerank' }"
                                    @click="toggleSizeViz('pagerank')">
                                    <i data-lucide="bar-chart-2" class="h-3 w-3"></i> PageRank
                                </button>
                                <div
                                    class="hidden group-hover:block absolute left-full top-0 ml-2 w-48 p-2 bg-black text-white text-xs font-bold rounded shadow-lg z-50 pointer-events-none">
                                    Sizes nodes based on their influence. Larger nodes are more "important".
                                </div>
                            </div>

                            <!-- Degree -->
                            <div class="group relative">
                                <button class="btn-structural w-full justify-start gap-1 text-xs"
                                    :class="{ 'active': activeSizeViz === 'degree' }" @click="toggleSizeViz('degree')">
                                    <i data-lucide="circle" class="h-3 w-3"></i> Degree
                                </button>
                                <div
                                    class="hidden group-hover:block absolute left-full top-0 ml-2 w-48 p-2 bg-black text-white text-xs font-bold rounded shadow-lg z-50 pointer-events-none">
                                    Sizes nodes by connection count. Larger nodes have more direct connections.
                                </div>
                            </div>

                            <!-- Betweenness -->
                            <div class="group relative">
                                <button class="btn-structural w-full justify-start gap-1 text-xs"
                                    :class="{ 'active': activeColorViz === 'betweenness' }"
                                    @click="toggleColorViz('betweenness')">
                                    <i data-lucide="git-commit" class="h-3 w-3"></i> Betweenness
                                </button>
                                <div
                                    class="hidden group-hover:block absolute left-full top-0 ml-2 w-48 p-2 bg-black text-white text-xs font-bold rounded shadow-lg z-50 pointer-events-none">
                                    Colors nodes based on "bridging" score. Redder nodes lie on more shortest paths.
                                </div>
                            </div>

                            <!-- Components -->
                            <div class="group relative">
                                <button class="btn-structural w-full justify-start gap-1 text-xs"
                                    :class="{ 'active': activeColorViz === 'components' }"
                                    @click="toggleColorViz('components')">
                                    <i data-lucide="share-2" class="h-3 w-3"></i> Components
                                </button>
                                <div
                                    class="hidden group-hover:block absolute left-full top-0 ml-2 w-48 p-2 bg-black text-white text-xs font-bold rounded shadow-lg z-50 pointer-events-none">
                                    Highlights the largest connected group of nodes in Green.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Layout Group -->
                    <div>
                        <div class="mb-2 font-mono text-[10px] font-bold uppercase text-gray-400">Layout</div>
                        <div class="group relative">
                            <select x-model="layout" @change="runLayout($event.target.value)"
                                class="btn-structural w-full text-xs" style="cursor: pointer;">
                                <option value="forceatlas2">ForceAtlas2</option>
                                <option value="circular">Circular</option>
                                <option value="random">Random</option>
                                <option value="noverlap">Noverlap</option>
                            </select>
                            <div
                                class="hidden group-hover:block absolute left-full top-0 ml-2 w-48 p-2 bg-black text-white text-xs font-bold rounded shadow-lg z-50 pointer-events-none">
                                Select an algorithm to automatically arrange the nodes.
                            </div>
                        </div>
                    </div>

                    <!-- Actions Group -->
                    <div>
                        <div class="mb-2 font-mono text-[10px] font-bold uppercase text-gray-400">Actions</div>
                        <button @click="toggleStats()" class="btn-structural w-full justify-start gap-1 text-xs"
                            :class="{ 'active': showStats }">
                            <i data-lucide="info" class="h-3 w-3"></i> Toggle Stats
                        </button>
                    </div>

                    <!-- Help Group -->
                    <div class="pt-4 border-t border-gray-100">
                        <div class="mb-2 font-mono text-[10px] font-bold uppercase text-gray-400">Help</div>
                        <div class="text-[10px] text-gray-500 space-y-2 leading-relaxed font-mono">
                            <p>Push buttons to show graph features and click nodes to see details.</p>
                            <p>Use zoom controls to zoom and click & drag to move the graph.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2b. Graph Panel (Fills remaining width) -->
            <div class="flex-grow bg-gray-100 relative overflow-hidden">

                <!-- Open Left Sidebar Button -->
                <button x-show="!leftOpen" @click="leftOpen = true"
                    class="absolute left-0 top-4 bg-white p-1 border rounded-r shadow hover:bg-gray-50 z-10">
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </button>

                <!-- Open Right Sidebar Button -->
                <button x-show="!rightOpen" @click="rightOpen = true"
                    class="absolute right-0 top-4 bg-white p-1 border rounded-l shadow hover:bg-gray-50 z-10">
                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                </button>

                <!-- Graph Container -->
                <div id="sigma-container" class="absolute inset-0 z-0" x-ref="sigmaContainer"></div>

                <!-- Floating Stats Panel (Bottom Left) -->
                <div x-show="showStats"
                    class="absolute bottom-6 left-6 min-w-[200px] rounded-md border border-gray-300 bg-white/95 p-4 shadow-lg z-10 font-mono text-xs"
                    x-transition.opacity>
                    <div class="mb-2 border-b border-gray-200 pb-1 font-bold">Graph Statistics</div>
                    <div class="grid grid-cols-2 gap-x-4 gap-y-1">
                        <span class="text-gray-500">Nodes:</span> <span x-text="stats.nodes" class="font-bold"></span>
                        <span class="text-gray-500">Edges:</span> <span x-text="stats.edges" class="font-bold"></span>
                        <span class="text-gray-500">Density:</span> <span x-text="stats.density"
                            class="font-bold"></span>
                        <span class="text-gray-500">Avg Deg:</span> <span x-text="stats.avgDegree"
                            class="font-bold"></span>
                    </div>
                </div>

                <!-- Floating Zoom Controls (Top Right) -->
                <div
                    class="absolute top-4 right-14 flex flex-col gap-2 rounded-md border border-gray-300 bg-white/90 p-2 shadow-sm z-10">
                    <button class="btn-structural" @click="zoomIn()" title="Zoom In">
                        <i data-lucide="zoom-in" class="h-4 w-4"></i>
                    </button>
                    <button class="btn-structural" @click="zoomReset()" title="Reset Camera">
                        <i data-lucide="maximize" class="h-4 w-4"></i>
                    </button>
                    <button class="btn-structural" @click="zoomOut()" title="Zoom Out">
                        <i data-lucide="zoom-out" class="h-4 w-4"></i>
                    </button>
                </div>
            </div>

            <!-- 2c. Right Sidebar (Fixed Width, Collapsible) -->
            <div x-show="rightOpen"
                class="flex-none w-80 flex flex-col border-l border-gray-300 bg-white shadow-sm transition-all z-20"
                x-transition:enter="transition ease-out duration-200" x-transition:enter-start="translate-x-full"
                x-transition:enter-end="translate-x-0" x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="translate-x-0" x-transition:leave-end="translate-x-full">
                <div class="flex items-center justify-between p-2 border-b border-gray-200 bg-gray-50">
                    <button @click="rightOpen = false" class="text-gray-500 hover:text-black">
                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                    </button>
                    <span class="font-mono text-xs font-bold uppercase text-gray-600">Details</span>
                </div>

                <div class="flex-grow overflow-y-auto p-4 space-y-6">
                    <!-- Help Section (Collapsible) -->
                    <div>
                        <details x-ref="analysisGuide"
                            class="group open:bg-gray-50 open:ring-1 open:ring-black/5 rounded-lg p-2 transition-all duration-300"
                            open>
                            <summary
                                class="flex items-center justify-between cursor-pointer list-none font-bold text-xs text-gray-500 uppercase tracking-wider">
                                <span>Analysis Guide</span>
                                <span class="transition group-open:rotate-180">
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                </span>
                            </summary>

                            <div class="text-xs text-gray-500 space-y-2 leading-relaxed font-mono mt-2">
                                <p><strong>Welcome to the Knowledge Graph.</strong></p>
                                <p>This interactive map visualizes the relationships between key concepts.</p>
                                <ul class="list-disc pl-4 space-y-1">
                                    <li><strong>Nodes</strong> represent individual entities or concepts.</li>
                                    <li><strong>Lines</strong> show the connections between them.</li>
                                    <li><strong>Colors</strong> indicate communities or clusters of related topics.</li>
                                    <li><strong>Size</strong> reflects the importance or influence of a node within the
                                        network.</li>
                                </ul>
                                <p class="mt-2">Use the controls on the left to explore different perspectives and click
                                    on any node to dive deeper into its details.</p>
                            </div>
                        </details>
                    </div>

                    <!-- Node Details Section -->
                    <div x-show="selectedNode" class="space-y-4 border-t border-gray-100 pt-4"
                        x-transition:enter="transition ease-out duration-300"
                        x-transition:enter-start="opacity-0 translate-y-2"
                        x-transition:enter-end="opacity-100 translate-y-0">

                        <div class="flex items-center justify-between pb-2">
                            <div class="text-xs text-gray-500 uppercase font-bold tracking-wider">Node Data</div>
                            <button @click="selectedNode = null" class="text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="w-3 h-3"></i>
                            </button>
                        </div>

                        <template x-if="selectedNode">
                            <div class="space-y-4 animate-in fade-in slide-in-from-right-4 duration-300">
                                <div>
                                    <div class="text-[10px] uppercase text-gray-400 font-bold tracking-wider mb-1">Label
                                    </div>
                                    <div class="text-sm font-bold text-gray-900" x-text="selectedNode.label"></div>
                                </div>

                                <div>
                                    <div class="text-[10px] uppercase text-gray-400 font-bold tracking-wider mb-1">Type
                                    </div>
                                    <span
                                        class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"
                                        x-text="selectedNode.nodeType"></span>
                                </div>

                                <div>
                                    <div class="text-[10px] uppercase text-gray-400 font-bold tracking-wider mb-1">
                                        Definition</div>
                                    <div class="text-xs text-gray-600 leading-relaxed font-mono"
                                        x-text="selectedNode.definition || 'No definition available.'"></div>
                                </div>

                                <div class="pt-4 border-t border-gray-100">
                                    <div class="grid grid-cols-2 gap-2 text-xs">
                                        <div>
                                            <span class="text-gray-400">Degree:</span>
                                            <span class="font-mono ml-1"
                                                x-text="graph ? graph.degree(selectedNode.id) : 0"></span>
                                        </div>
                                        <div>
                                            <span class="text-gray-400">ID:</span>
                                            <span class="font-mono ml-1 truncate" x-text="selectedNode.id"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>

                    </div>
                </div>
            </div>

        </div>

    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('sigmaApp', () => ({
                status: 'Initializing...',
                graph: null,
                renderer: null,
                activeColorViz: null,
                activeSizeViz: null,
                layout: 'forceatlas2',
                showStats: false,
                stats: { nodes: 0, edges: 0, density: 0, avgDegree: 0 },
                leftOpen: true,
                rightOpen: true,
                rightOpen: true,
                selectedNode: null,
                loaded: false,

                init() {
                    setTimeout(() => this.loaded = true, 50);
                    this.initSqlJs();
                    this.$nextTick(() => { if (window.lucide) window.lucide.createIcons(); });
                },

                initSqlJs() {
                    initSqlJs({
                        locateFile: (file) => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}`,
                    }).then((SQL) => {
                        const xhr = new XMLHttpRequest();
                        xhr.open("GET", "/data/ctx.db", true);
                        xhr.responseType = "arraybuffer";

                        xhr.onload = (e) => {
                            if (xhr.status !== 200) {
                                this.status = `<span class="text-red-500">Error: ctx.db not found (Status ${xhr.status})</span>`;
                                return;
                            }
                            const uInt8Array = new Uint8Array(xhr.response);
                            const db = new SQL.Database(uInt8Array);
                            this.loadGraph(db);
                        };
                        xhr.send();
                    });
                },

                loadGraph(db) {
                    // 1. Instantiate Graphology
                    this.graph = new graphology.Graph();
                    this.status = "Extracting Data...";

                    // 2. Query Nodes
                    try {
                        const nodesStmt = db.prepare("SELECT * FROM nodes");
                        while (nodesStmt.step()) {
                            const row = nodesStmt.getAsObject();
                            this.graph.addNode(row.id, {
                                label: row.label,
                                nodeType: row.type || 'Unknown',
                                definition: row.definition || '',
                                size: row.type === "Core Concept" ? 15 : 5,
                                color: row.type === "Core Concept" ? "black" : "#475569",
                                originalSize: row.type === "Core Concept" ? 15 : 5,
                                originalColor: row.type === "Core Concept" ? "black" : "#475569",
                                x: Math.random() * 100,
                                y: Math.random() * 100,
                            });
                        }
                    } catch (e) {
                        console.error("Node Error", e);
                    }

                    // 3. Query Edges
                    try {
                        const edgesStmt = db.prepare("SELECT * FROM edges");
                        while (edgesStmt.step()) {
                            const row = edgesStmt.getAsObject();
                            if (this.graph.hasNode(row.source) && this.graph.hasNode(row.target)) {
                                if (!this.graph.hasEdge(row.source, row.target)) {
                                    this.graph.addEdge(row.source, row.target, {
                                        type: "arrow",
                                        label: row.relation,
                                        size: 2,
                                        color: "#e5e5e5",
                                    });
                                }
                            }
                        }
                    } catch (e) {
                        console.error("Edge Error", e);
                    }

                    const nodeCount = this.graph.order;
                    const edgeCount = this.graph.size;
                    this.status = `Graph Loaded: ${nodeCount} Nodes, ${edgeCount} Edges. Running Physics...`;

                    // 4. Run Layout (ForceAtlas2)
                    this.runLayout('forceatlas2');

                    // 5. Render with Sigma
                    const container = this.$refs.sigmaContainer;
                    container.innerHTML = ""; // Clear previous

                    this.renderer = new Sigma(this.graph, container, {
                        renderEdgeLabels: true,
                        nodeReducer: (node, data) => {
                            if (this.selectedNode && node === this.selectedNode.id) {
                                return { ...data, highlighted: true, size: Math.max(data.size, 15), zIndex: 10, label: data.label };
                            }
                            return data;
                        },
                        zIndex: true,
                    });

                    // Disable mouse wheel zoom
                    try {
                        if (this.renderer.getMouseCaptor()) {
                            this.renderer.getMouseCaptor().isMouseWheelEnabled = false;
                        }
                    } catch (e) { }

                    container.addEventListener("wheel", (e) => e.stopPropagation(), true);

                    this.status = "Interactive Mode Active. Buttons to Zoom, Drag to Move.";

                    // Event Listeners
                    this.renderer.on("clickNode", ({ node }) => {
                        const attrs = this.graph.getNodeAttributes(node);
                        this.selectedNode = { id: node, ...attrs };
                        this.rightOpen = true;
                        this.$refs.analysisGuide.open = false;
                        this.renderer.refresh();
                    });

                    this.renderer.on("clickStage", () => {
                        this.selectedNode = null;
                        this.renderer.refresh();
                    });
                },

                zoomIn() {
                    if (!this.renderer) return;
                    const camera = this.renderer.getCamera();
                    camera.animate({ ratio: camera.ratio / 1.5 });
                },

                zoomOut() {
                    if (!this.renderer) return;
                    const camera = this.renderer.getCamera();
                    camera.animate({ ratio: camera.ratio * 1.5 });
                },

                zoomReset() {
                    if (!this.renderer) return;
                    this.renderer.getCamera().animatedReset();
                },

                resetColors() {
                    this.graph.forEachNode((node, attributes) => {
                        if (attributes.originalColor) this.graph.setNodeAttribute(node, "color", attributes.originalColor);
                    });
                },

                resetSizes() {
                    this.graph.forEachNode((node, attributes) => {
                        if (attributes.originalSize) this.graph.setNodeAttribute(node, "size", attributes.originalSize);
                    });
                },

                toggleColorViz(type) {
                    if (this.activeColorViz === type) {
                        this.resetColors();
                        this.activeColorViz = null;
                        this.renderer.refresh();
                        return;
                    }

                    this.resetColors();
                    this.activeColorViz = type;

                    if (type === 'louvain') {
                        if (!graphologyLibrary.communitiesLouvain) return alert("Louvain library not loaded.");
                        const communities = graphologyLibrary.communitiesLouvain(this.graph);
                        const colors = ["#e6194b", "#3cb44b", "#ffe119", "#4363d8", "#f58231", "#911eb4", "#46f0f0", "#f032e6", "#bcf60c", "#fabebe", "#008080", "#e6beff", "#9a6324", "#fffac8", "#800000", "#aaffc3", "#808000", "#ffd8b1", "#000075", "#808080", "#000000"];
                        this.graph.forEachNode((node) => {
                            this.graph.setNodeAttribute(node, "color", colors[communities[node] % colors.length]);
                        });
                    } else if (type === 'betweenness') {
                        if (!graphologyLibrary.metrics) return alert("Metrics library not loaded.");
                        const scores = graphologyLibrary.metrics.centrality.betweenness(this.graph);
                        const minScore = Math.min(...Object.values(scores));
                        const maxScore = Math.max(...Object.values(scores));
                        this.graph.forEachNode((node) => {
                            const normalized = (scores[node] - minScore) / (maxScore - minScore);
                            // Slate 400 (148, 163, 184) to Red 600 (220, 38, 38)
                            const r = Math.floor(148 + (220 - 148) * normalized);
                            const g = Math.floor(163 + (38 - 163) * normalized);
                            const b = Math.floor(184 + (38 - 184) * normalized);
                            this.graph.setNodeAttribute(node, "color", `rgb(${r}, ${g}, ${b})`);
                        });
                    } else if (type === 'components') {
                        if (!graphologyLibrary.components) return alert("Components library not loaded.");
                        const componentArrays = graphologyLibrary.components.connectedComponents(this.graph);
                        let largestComponent = [];
                        componentArrays.forEach(comp => {
                            if (comp.length > largestComponent.length) largestComponent = comp;
                        });
                        const largestComponentSet = new Set(largestComponent);
                        this.graph.forEachNode((node) => {
                            this.graph.setNodeAttribute(node, "color", largestComponentSet.has(node) ? "#3cb44b" : "#cccccc");
                        });
                    }
                    this.renderer.refresh();
                },

                toggleSizeViz(type) {
                    if (this.activeSizeViz === type) {
                        this.resetSizes();
                        this.activeSizeViz = null;
                        this.renderer.refresh();
                        return;
                    }

                    this.resetSizes();
                    this.activeSizeViz = type;

                    if (!graphologyLibrary.metrics) return alert("Metrics library not loaded.");

                    if (type === 'pagerank') {
                        const scores = graphologyLibrary.metrics.centrality.pagerank(this.graph);
                        const minScore = Math.min(...Object.values(scores));
                        const maxScore = Math.max(...Object.values(scores));
                        this.graph.forEachNode((node) => {
                            this.graph.setNodeAttribute(node, "size", 3 + ((scores[node] - minScore) / (maxScore - minScore)) * 27);
                        });
                    } else if (type === 'degree') {
                        const scores = graphologyLibrary.metrics.centrality.degree(this.graph);
                        const minScore = Math.min(...Object.values(scores));
                        const maxScore = Math.max(...Object.values(scores));
                        this.graph.forEachNode((node) => {
                            this.graph.setNodeAttribute(node, "size", 4 + ((scores[node] - minScore) / (maxScore - minScore)) * 21);
                        });
                    }
                    this.renderer.refresh();
                },

                runLayout(layoutName) {
                    this.layout = layoutName;
                    const lib = window.graphologyLibrary;
                    if (!lib) return;

                    if (layoutName === 'forceatlas2') {
                        if (lib.layoutForceAtlas2) {
                            lib.layoutForceAtlas2.assign(this.graph, { iterations: 50, settings: { gravity: 1 } });
                        }
                    } else if (layoutName === 'circular') {
                        if (lib.layout && lib.layout.circular) lib.layout.circular.assign(this.graph);
                    } else if (layoutName === 'random') {
                        if (lib.layout && lib.layout.random) lib.layout.random.assign(this.graph);
                    } else if (layoutName === 'noverlap') {
                        if (lib.layoutNoverlap) lib.layoutNoverlap.assign(this.graph);
                    }

                    if (this.renderer) {
                        this.renderer.refresh();
                        this.renderer.getCamera().animatedReset();
                    }
                },

                toggleStats() {
                    this.showStats = !this.showStats;
                    if (this.showStats) {
                        this.stats.nodes = this.graph.order;
                        this.stats.edges = this.graph.size;
                        this.stats.density = graphologyLibrary.metrics.graph.density(this.graph).toFixed(4);
                        this.stats.avgDegree = ((2 * this.stats.edges) / this.stats.nodes).toFixed(2);
                    }
                }
            }));
        });
    </script>
</body>

</html>